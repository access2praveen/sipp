<?xml version='1.0' encoding='ISO-8859-1'?>
<scenario name="SIPP scenario genertated by sipp_xml_generated">

<nop display="INVITE (client) connection:" />
<nop>
  <action>
    <assignstr assign_to="sdp_v" value="v=0" />
    <assignstr assign_to="sdp_o" value="o=user1 53655765 2353687637 IN IP[local_ip_type] [local_ip]" />
    <assignstr assign_to="sdp_s" value="s=-" />
    <assignstr assign_to="sdp_c" value="c=IN IP[media_ip_type] [media_ip]" />
    <assignstr assign_to="sdp_t" value="t=0 0" />
    <!-- PCMU -->
    <assignstr assign_to="sdp_m" value="[$sdp_m] 0" />
    <assignstr assign_to="sdp_a_pcmu" value="a=rtpmap:0 PCMU/8000" />
    <assignstr assign_to="sdp_a" value="[$sdp_a]\n[$sdp_a_pcmu]" />
    <!-- PCMA -->
    <assignstr assign_to="sdp_m" value="[$sdp_m] 8" />
    <assignstr assign_to="sdp_a_pcma" value="a=rtpmap:8 PCMA/8000" />
    <assignstr assign_to="sdp_a" value="[$sdp_a]\n[$sdp_a_pcma]" />
    <!-- G722 -->
    <assignstr assign_to="sdp_m" value="[$sdp_m] 9" />
    <assignstr assign_to="sdp_a_g722" value="a=rtpmap:9 G722/8000" />
    <assignstr assign_to="sdp_a" value="[$sdp_a]\n[$sdp_a_g722]" />

    <!-- G7221 24k bitrate-->
    <assignstr assign_to="sdp_m" value="[$sdp_m] 121" />
    <assignstr assign_to="sdp_a_g7221_24kbps" value="a=rtpmap:121 G7221/16000\na=fmtp:121 bitrate=24000" />
    <assignstr assign_to="sdp_a" value="[$sdp_a]\n[$sdp_a_g7221_24kbps]" />
    <!-- G7221 32k bitrate-->
    <assignstr assign_to="sdp_m" value="[$sdp_m] 122" />
    <assignstr assign_to="sdp_a_g7221_32kbps" value="a=rtpmap:122 G7221/16000\na=fmtp:122 bitrate=32000" />
    <assignstr assign_to="sdp_a" value="[$sdp_a]\n[$sdp_a_g7221_32kbps]" />

     <!-- G7221C 24k bitrate-->
    <assignstr assign_to="sdp_m" value="[$sdp_m] 123" />
    <assignstr assign_to="sdp_a_g7221c_24kbps" value="a=rtpmap:123 G7221/32000\na=fmtp:123 bitrate=24000" />
    <assignstr assign_to="sdp_a" value="[$sdp_a]\n[$sdp_a_g7221c_24kbps]" />

    <!-- G7221C 32k bitrate-->
    <assignstr assign_to="sdp_m" value="[$sdp_m] 124" />
    <assignstr assign_to="sdp_a_g7221c_32kbps" value="a=rtpmap:124 G7221/32000\na=fmtp:124 bitrate=32000" />
    <assignstr assign_to="sdp_a" value="[$sdp_a]\n[$sdp_a_g7221c_32kbps]" />
    <!-- G7221C 48k bitrate-->
    <assignstr assign_to="sdp_m" value="[$sdp_m] 125" />
    <assignstr assign_to="sdp_a_g7221c_48kbps" value="a=rtpmap:125 G7221/32000\na=fmtp:125 bitrate=48000" />
    <assignstr assign_to="sdp_a" value="[$sdp_a]\n[$sdp_a_g7221c_48kbps]" />

    <assignstr assign_to="sdp" value="[$sdp_v]" />
    <assignstr assign_to="sdp" value="[$sdp]\n[$sdp_o]" />
    <assignstr assign_to="sdp" value="[$sdp]\n[$sdp_c]" />
    <assignstr assign_to="sdp" value="[$sdp]\n[$sdp_s]" />
    <assignstr assign_to="sdp" value="[$sdp]\n[$sdp_t]" />
    <assignstr assign_to="sdp" value="[$sdp]\nm=audio [media_port] RTP/AVP [$sdp_m]" />
    <assignstr assign_to="sdp" value="[$sdp]\n[$sdp_a]" />
    <assignstr assign_to="sdp_invite" value="[$sdp]" />
    <assignstr assign_to="sdp_ack" value="" />
  </action>
</nop>

  <send start_rtd="invite"><!-- Generated CDATA -->
    <![CDATA[
      INVITE sip:[service]@[remote_ip]:[remote_port] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      From: sipp <sip:sipp@[local_ip]:[local_port]>;tag=[call_number]
      To: sut <sip:[service]@[remote_ip]:[remote_port]>
      Call-ID: [call_id]
      CSeq: [cseq] INVITE
      Contact: sip:sipp@[local_ip]:[local_port]
      Max-Forwards: 70
      X-DolbyVoice-Client-LogId: sipp_client_0
      X-DolbyVoice-MediaServer-MultiCodec: 1
      Subject: Performance Test
      Allow: INVITE, ACK, BYE, CANCEL, OPTIONS, PRACK, MESSAGE, SUBSCRIBE, NOTIFY, REFER, UPDATE, REGISTER, INFO
      Supported: 100rel
      Content-Type: application/sdp
      Content-Length:0

      [$sdp_ack]

    
  ]]>
<!-- End of Generated CDATA -->
</send>

  <recv optional="true" response="100">
  </recv>

  <recv optional="true" response="180">
  </recv>

  <recv response="200" rtd="invite">
    <action>
      <ereg assign_to="unused,client_sip_id" header="To:" regexp="tag=\s*(\S*)" search_in="hdr" />
      <ereg assign_to="unused,audio_port" regexp="m=audio (\S+) " search_in="body" />
      <!-- o=<username> <sess-id> <sess-version> <nettype> <addrtype> <unicast-address> -->
      <ereg assign_to="unused,audio_ip" regexp="o=\S+ \S+ \S+ \S+ \S+ (\S+)" search_in="body" />
    </action>
  </recv>

  <Reference variables="unused,client_sip_id" />
  <send crlf="true"><!-- Generated CDATA -->
    <![CDATA[
      ACK sip:[service]@[remote_ip]:[remote_port] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      From: sipp <sip:sipp@[local_ip]:[local_port]>;tag=[call_number]
      To: sut <sip:[service]@[remote_ip]:[remote_port]>[peer_tag_param]
      Call-ID: [call_id]
      CSeq: [cseq] ACK
      Contact: sip:sipp@[local_ip]:[local_port]
      Max-Forwards: 70
      Subject: Performance Test
      Content-Type: application/sdp
      Content-Length: [len]

      [$sdp_invite]

    
  ]]>
<!-- End of Generated CDATA -->
</send>

<!--
<nop crlf="true" display="play multiple codec audio">
  <action>
    <log message="./PlayMultiCodecCodec.sh [$audio_ip]/[$audio_port]"></log>
    <exec command="./PlayMultiCodecCodec.sh [$audio_ip]/[$audio_port] &> log/all_codec.playrtpdump.log &"></exec>
  </action>
  </nop>
-->
<nop display="wait for 1000 msec:" />
  <pause crlf="true" milliseconds="1000" />

<nop display="create conf_0:" />
  <send><!-- Generated CDATA -->
       <![CDATA[
        INFO sip:[service]@[remote_ip]:[remote_port] SIP/2.0
        Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
        From: sipp <sip:sipp@[local_ip]:[local_port]>;tag=[call_number]
        To: sut <sip:[service]@[remote_ip]:[remote_port]>[peer_tag_param]
        Call-ID: [call_id]
        CSeq: [cseq] INFO
        Contact: sip:sipp@[local_ip]:[local_port]
        Accept: application/sdp, text/*, application/msml+xml, application/moml+xml
        Allow: INVITE, ACK, BYE, CANCEL, OPTIONS, PRACK, MESSAGE, SUBSCRIBE, NOTIFY, REFER, UPDATE, REGISTER, INFO
        Supported: 100rel
        Content-Type: application/msml+xml
        Content-Length: [len]

        <msml version="1.1">
          <createconference name="conf_0" deletewhen="nomedia">
            <audiomix>
              <asn ri="3s" />
              <n-loudest n="4" />
            </audiomix>
          </createconference>
        </msml>
       
  ]]>
<!-- End of Generated CDATA -->
</send>
  <recv crlf="true" response="200" />

<nop display="wait for 1000 msec:" />
  <pause crlf="true" milliseconds="1000" />

<nop display="join conf_0:" />
  <send><!-- Generated CDATA -->
       <![CDATA[
        INFO sip:[service]@[remote_ip]:[remote_port] SIP/2.0
        Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
        From: sipp <sip:sipp@[local_ip]:[local_port]>;tag=[call_number]
        To: sut <sip:[service]@[remote_ip]:[remote_port]>[peer_tag_param]
        Call-ID: [call_id]
        CSeq: [cseq] INFO
        Contact: sip:sipp@[local_ip]:[local_port]
        Accept: application/sdp, text/*, application/msml+xml, application/moml+xml
        Allow: INVITE, ACK, BYE, CANCEL, OPTIONS, PRACK, MESSAGE, SUBSCRIBE, NOTIFY, REFER, UPDATE, REGISTER, INFO
        Supported: 100rel
        Content-Type: application/msml+xml
        Content-Length: [len]

        <msml version="1.1">
          <join id1="conn:[$client_sip_id]" id2="conf:conf_0">
            <stream dir="to-id1" media="audio" dlb:echo_suppression="disable" dlb:audio_processing="enable" dlb:fec="disable" dlb:audio_processing_ver="2">
              <clamp dtmf="false" />
              <gain amt="0" />
            </stream>
            <stream dir="from-id1" media="audio" dlb:jb_min_latency="0ms">
              <clamp dtmf="true" />
              <gain amt="0" />
            </stream>
          </join>
        </msml>

       
  ]]>
<!-- End of Generated CDATA -->
</send>
  <recv crlf="true" response="200" />


<nop crlf="true" display="play multiple codec audio">
  <action>
    <log message="rtpplay -T -f  rtpdump_g7xx/Harvard_Female_g7221c_48_g711a10_g7221_24_g711u30_g7221c_32_g72230_g7221c_24_g7221_32.rtpdump [$audio_ip]/[$audio_port]"></log>
 <exec command="rtpplay -T -f  rtpdump_g7xx/Harvard_Female_g7221c_48_g711a10_g7221_24_g711u30_g7221c_32_g72230_g7221c_24_g7221_32.rtpdump [$audio_ip]/[$audio_port] &> log/all_codec.playrtpdump.log &"></exec>
  </action>
  </nop>


<nop display="wait for 180000 msec:" />
  <pause crlf="true" milliseconds="120000" />

<nop display="send BYE" />
<send><!-- Generated CDATA -->
    <![CDATA[
      BYE sip:[service]@[remote_ip]:[remote_port] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      From: sipp <sip:sipp@[local_ip]:[local_port]>;tag=[call_number]
      To: sut <sip:[service]@[remote_ip]:[remote_port]>[peer_tag_param]
      Call-ID: [call_id]
      CSeq: [cseq] BYE
      Contact: sip:sipp@[local_ip]:[local_port]
      Max-Forwards: 70
      Subject: Performance Test
      Content-Length: 0

    
]]>
<!-- End of Generated CDATA -->
</send>
<recv crlf="true" response="200" />

<label id="_unexp.retaddr"></label>
<nop crlf="true" display="stop multiple codec audio play">
  <action>
    <log message="stop multiple codec audio play"></log>
    <exec command="pkill -f rtpplay.*[$audio_ip]/[$audio_port]"></exec>
  </action>
</nop>

</scenario>
